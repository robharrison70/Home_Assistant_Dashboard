<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systems Inventory</title>
    <style>
        :root { --fpv: #ff6600; --ha: #03a9f4; --bg: #0a0a0a; --card: #161616; --text: #e0e0e0; }
        body { font-family: 'Consolas', monospace; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
        
        .nav-bar { display: flex; background: #000; border-bottom: 2px solid #333; position: sticky; top: 0; z-index: 100; }
        .nav-btn { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-weight: bold; border: none; background: none; color: #555; transition: 0.3s; font-size: 0.9rem; }
        .nav-btn.active.fpv-btn { color: var(--fpv); border-bottom: 3px solid var(--fpv); }
        .nav-btn.active.ha-btn { color: var(--ha); border-bottom: 3px solid var(--ha); }

        .container { max-width: 900px; margin: auto; padding: 20px; }
        .inventory-table { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 8px; overflow: hidden; margin-top: 20px; border: 1px solid #2a2a2a; }
        .inventory-table th { background: #1a1a1a; padding: 15px; text-align: left; color: #888; font-size: 0.7rem; text-transform: uppercase; }
        .inventory-table td { padding: 15px; border-bottom: 1px solid #222; text-align: left; font-size: 0.9rem; }
        
        .status-tag { background: #222; padding: 4px 8px; border-radius: 4px; border: 1px solid #444; font-size: 0.8rem; }
        .loading-msg { text-align: center; margin-top: 50px; color: var(--fpv); font-style: italic; letter-spacing: 2px; }
        
        .footer-info { text-align: center; margin-top: 40px; padding: 20px; border-top: 1px solid #222; color: #555; font-size: 0.7rem; letter-spacing: 1px; }
        #last-sync { color: var(--ha); }
    </style>
</head>
<body>

    <div class="nav-bar">
        <button id="btn-drone" class="nav-btn active fpv-btn" onclick="showCategory('Drone')">üõ∏ FPV HANGAR</button>
        <button id="btn-home" class="nav-btn ha-btn" onclick="showCategory('Home')">üè† SMART HOME</button>
    </div>

    <div class="container">
        <div id="content">
            <div class="loading-msg">INITIALIZING SYSTEM DATA...</div>
        </div>
        
        <div class="footer-info">
            SYSTEM STATUS: ONLINE | LAST DATA SYNC: <span id="last-sync">NEVER</span>
        </div>
    </div>

    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRLPLCFFC8Hi3lfSSHxo-1KRi9BYhboLM7s2zCZXSmCQbXtjIC9mdbzgi-J_kgdGO4XiEWzGQXZRoMV/pub?gid=0&single=true&output=csv";
        
        let masterData = [];

        async function init() {
            try {
                const response = await fetch(sheetUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                const text = await response.text();
                
                // Parse CSV rows and AGGRESSIVELY trim spaces
                const rows = text.split('\n');
                masterData = rows.map(row => {
                    return row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(cell => cell.replace(/"/g, '').trim());
                });

                // Update the timestamp
                const now = new Date();
                document.getElementById('last-sync').innerText = now.toLocaleTimeString();

                showCategory('Drone'); 
            } catch (error) {
                console.error("Fetch error:", error);
                document.getElementById('content').innerHTML = `<div style="color:red; text-align:center; padding:20px;">‚ö†Ô∏è ERROR: Could not connect to Google Sheets.</div>`;
            }
        }

        function showCategory(cat) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if(cat === 'Drone') document.getElementById('btn-drone').classList.add('active');
            if(cat === 'Home') document.getElementById('btn-home').classList.add('active');

            let html = `<table class="inventory-table">
                <thead><tr><th>Model</th><th>Specs</th><th>Status</th></tr></thead>
                <tbody>`;
            
            let count = 0;
            masterData.forEach((cols, index) => {
                // This checks column 0 for the category
                if (index > 0 && cols[0] === cat) {
                    count++;
                    html += `<tr>
                        <td><strong>${cols[1] || '---'}</strong></td>
                        <td>${cols[2] || '---'}</td>
                        <td><span class="status-tag">${cols[3] || 'Unknown'}</span></td>
                    </tr>`;
                }
            });

            if (count === 0) {
                html += `<tr><td colspan="3" style="text-align:center; padding:40px; color:#666;">No items found for "${cat}". <br><br>Current Data in Sheet: ${masterData.length > 1 ? masterData[1][0] : 'Empty'}</td></tr>`;
            }

            html += `</tbody></table>`;
            document.getElementById('content').innerHTML = html;
        }

        window.onload = init;
    </script>
</body>
</html>
